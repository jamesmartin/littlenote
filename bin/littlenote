#!/usr/bin/env ruby

options = {}

require 'optparse'
OptionParser.new do |opts|
  opts.banner = "Usage: littlenote [options]"

  opts.on("-dDIR", "--directory=DIR", "Directory to write notes into (default: '.')") do |d|
    options[:directory] = d
  end
end.parse!

require 'yaml'
class LittleConfig
  attr_reader :config

  def initialize
    @config = YAML.load(File.open(File.join(ENV['HOME'], '.littlenote'), 'r'))
  rescue Errno::ENOENT
    @config = {}
  end
end

config = LittleConfig.new.config

require 'date'
datetime_stamp = DateTime.now
directory = options[:directory] || config['directory'] || "./"
filename = File.join(directory, "#{datetime_stamp}.md")

if $0 == __FILE__
  begin
    File.open(filename, 'w+') do |f|
      f << "# #{datetime_stamp}"
    end

    if ENV['EDITOR']
      exec(ENV['EDITOR'], filename)
    end
  rescue Errno::ENOENT
    puts "There was a problem writing to: '#{filename}'"
  end
end
